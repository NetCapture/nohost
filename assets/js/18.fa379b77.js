(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{449:function(t,s,n){"use strict";n.r(s);var a=n(52),e=Object(a.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"如何生成自定义菜单"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#如何生成自定义菜单"}},[t._v("#")]),t._v(" 如何生成自定义菜单")]),t._v(" "),n("p",[t._v("自定义菜单通过识别 "),n("code",[t._v("window.nohostContextMenuExtensions")]),t._v(" 的值来进行生成自定义菜单\n"),n("code",[t._v("nohostContextMenuExtensions")]),t._v(" 值类型如下：")]),t._v(" "),n("div",{staticClass:"language-ts extra-class"},[n("pre",{pre:!0,attrs:{class:"language-ts"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MenuItem")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  name"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  title"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  autoHide"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("boolean")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// default true")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onClick")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" MouseEvent "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("hide")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 调用hide可以关闭菜单")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("nohostContextMenuExtensions")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" MenuItem"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[n("em",[n("strong",[t._v("默认点击菜单会自动关闭菜单的，如果要手动关闭菜单，需要设置item.autoHide为false，并手动调用e.hide方法进行关闭")])])]),t._v(" "),n("p",[t._v("可以通过 Whistle 插件或者 rule 的形式，注入 "),n("code",[t._v("window.nohostContextMenuExtensions")]),t._v("。")]),t._v(" "),n("blockquote",[n("p",[t._v("建议不要直接对该属性赋值,不然可能存在覆盖其他插件的自定义菜单的可能。")])]),t._v(" "),n("p",[n("em",[n("strong",[t._v("例子")])]),t._v("\n通过Whistle rule直接注入")]),t._v(" "),n("div",{staticClass:"language-ts extra-class"},[n("pre",{pre:!0,attrs:{class:"language-ts"}},[n("code",[n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" jsAppend"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("test"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v(" test.js\n;(function() {\n  // Xxx 表示插件的名称，如果插件 whsitle.test, 则为 window.__nohostTestPluginExtMenusDidMount__\n  if (window.__nohostXxxPluginExtMenusDidMount__) {\n\treturn;\n  }\n  window.__nohostXxxPluginExtMenusDidMount__ = true;\n  if (Object.prototype.toString.call(window.nohostContextMenuExtensions) === '[object Array]') {\n    window.nohostContextMenuExtensions.push(\n      { name: '测试不关闭', title: '测试', autoHide: false, onClick: (e) => { console.log('测试'); } },\n      { name: '测试关闭', title: '测试', onClick: (e) => { console.log('测试'); } },\n    );\n  } else {\n  \twindow.nohostContextMenuExtensions = [\n      { name: '测试不关闭', title: '测试', autoHide: false, onClick: (e) => { console.log('测试'); } },\n      { name: '测试关闭', title: '测试', onClick: (e) => { console.log('测试'); } }\n    ];\n  }\n})();\n")]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v("\n")])])]),n("p",[t._v("注意要在 "),n("code",[t._v("__nohostXxxPluginExtMenusDidMount__")]),t._v(" 变量标记是否已经注册过，不然可能会反复注册，导致菜单重复出现")]),t._v(" "),n("p",[t._v("除了直接内联js，也支持外链的形式注入：")]),t._v(" "),n("ol",[n("li",[t._v("通过cdn上的js注入"),n("div",{staticClass:"language-ts extra-class"},[n("pre",{pre:!0,attrs:{class:"language-ts"}},[n("code",[n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v(' ext-menu.html\n<script src="https://x.cdn.com/path/to/menus.js"><\/script>\n')]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v("\n\nke"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("qq"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com htmlAppend"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("whistle"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("xxx"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("ext"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("menu"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),n("li",[t._v("通过插件内部的js注入"),n("div",{staticClass:"language-ts extra-class"},[n("pre",{pre:!0,attrs:{class:"language-ts"}},[n("code",[t._v("ke"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("qq"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com htmlAppend"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("whistle"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("xxx"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("ext"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("menu"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v(' ext-menu.html\n<script src="/.whistle-path.5b6af7b9884e1165/whistle.xxx/path/to/menus.js"><\/script>\n')]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v("\n")])])]),n("code",[t._v("/...whistle-path.5b6af7b9884e1165.../")]),t._v(" 是Whistle内部路径，要修改的是后面/whistle.xxx/path/to/menus.js的部分")])]),t._v(" "),n("p",[t._v("效果：")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://user-images.githubusercontent.com/11450939/92067071-07ed5500-edd6-11ea-84b0-22ce7fd0a471.png",alt:"image"}})]),t._v(" "),n("p",[n("img",{attrs:{src:"https://user-images.githubusercontent.com/11450939/92067083-0b80dc00-edd6-11ea-9520-532ddf225706.png",alt:"image"}})])])}),[],!1,null,null,null);s.default=e.exports}}]);